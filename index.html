<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with Groq | Hayden Kong</title>
    <link rel="icon" href="https://asset.brandfetch.io/idxygbEPCQ/idzCyF-I44.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <img class="logo" src="https://raw.githubusercontent.com/RMNCLDYO/groq-ai-toolkit/main/.github/groq-logo.png" alt="">
    <h1>Chat with Groq API</h1>
    <div id="chat-container">
        <div class="custom-select-wrapper">
            <div class="custom-select">
                <div class="custom-select-trigger">
                    <img id="selected-icon" src="https://cdn.vectorstock.com/i/500p/60/05/meta-symbol-vector-41876005.jpg" alt="Selected Icon" class="option-icon">
                    <span>Select AI Model</span>
                    <div class="arrow"></div>
                </div>
                <div class="custom-options">
                    <div class="custom-option selected" data-value="llama3-8b-8192" data-icon="https://cdn.vectorstock.com/i/500p/60/05/meta-symbol-vector-41876005.jpg">
                        <img src="https://cdn.vectorstock.com/i/500p/60/05/meta-symbol-vector-41876005.jpg" alt="Llama Icon" class="option-icon"> Llama 3 8b
                    </div>
                    <div class="custom-option" data-value="llama3-70b-8192" data-icon="https://cdn.vectorstock.com/i/500p/60/05/meta-symbol-vector-41876005.jpg">
                        <img src="https://cdn.vectorstock.com/i/500p/60/05/meta-symbol-vector-41876005.jpg" alt="Llama Icon" class="option-icon"> LLama 3 70b
                    </div>
                    <div class="custom-option" data-value="mixtral-8x7b-32768" data-icon="https://seeklogo.com/images/M/mistral-ai-icon-logo-B3319DCA6B-seeklogo.com.png">
                        <img src="https://seeklogo.com/images/M/mistral-ai-icon-logo-B3319DCA6B-seeklogo.com.png" alt="Mixtral Icon" class="option-icon"> Mixtral 8x7B
                    </div>
                    <div class="custom-option" data-value="gemma-7b-it" data-icon="https://kura.pro/sebastienrousseau/images/logos/gemma.webp">
                        <img src="https://kura.pro/sebastienrousseau/images/logos/gemma.webp" alt="Gemma Icon" class="option-icon"> Google Gemma 7b
                    </div>
                </div>
            </div>
            
        </div>
        <!-- TEST MESSAGES -->
        <!-- <div class="user-message">Hi</div>
        <div class="ai-message">Hello! I am a AI chatbot.</div> -->
    </div>

    <div id="input-area">
        <input type="text" id="message-input" placeholder="Type your message...">
        <button id="send-button">Send</button>
        <button style="margin-top: 5px; background-color: rgb(148, 148, 148);" id="clear-button">Clear Chat</button>
    </div>

    <script>
        // Get the clear button element
        const clearButton = document.getElementById("clear-button");

        // Function to clear chat history
        function clearChatHistory() {
        messageHistory = []; // Reset the message history
        localStorage.setItem('messageHistory', JSON.stringify(messageHistory)); // Clear from local storage
        const messageElements = document.querySelectorAll('.message');
        messageElements.forEach(element => element.remove()); // Remove all message elements
        }
        // Add event listener to the clear button
        clearButton.addEventListener("click", clearChatHistory);

    </script>

    <script type="importmap">
        {
            "imports": {
                "@groq-sdk": "https://esm.run/groq-sdk"
            }
        }
    </script>

    <script type="module">
        import Groq from "@groq-sdk";
        const groq = new Groq({ apiKey: "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", dangerouslyAllowBrowser: true });
        const chatContainer = document.getElementById("chat-container");
        const messageInput = document.getElementById("message-input");
        const sendButton = document.getElementById("send-button");
        let selectedModel = "llama3-8b-8192";
        let messageHistory = JSON.parse(localStorage.getItem('messageHistory')) || [];

        function addMessage(role, content) {
            const messageElement = document.createElement("p");
            messageElement.classList.add("message", `${role}-message`);
            messageElement.innerHTML = content.replace(/\n/g, "<br>"); // replace \n with <br>
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
        }

        document.addEventListener('DOMContentLoaded', function () {
            const selectWrapper = document.querySelector('.custom-select-wrapper');
            const selectTrigger = selectWrapper.querySelector('.custom-select-trigger');
            const optionsContainer = selectWrapper.querySelector('.custom-options');
            const optionsList = optionsContainer.querySelectorAll('.custom-option');
            const selectedIcon = document.getElementById('selected-icon');

            selectTrigger.addEventListener('click', () => {
                optionsContainer.classList.toggle('open');
            });

            optionsList.forEach(option => {
                option.addEventListener('click', () => {
                    const iconSrc = option.getAttribute('data-icon');
                    selectedIcon.src = iconSrc;
                    selectTrigger.querySelector('span').textContent = option.textContent.trim();
                    optionsContainer.classList.remove('open');
                    optionsList.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                });
            });

            window.addEventListener('click', (e) => {
                if (!selectWrapper.contains(e.target)) {
                    optionsContainer.classList.remove('open');
                }
            });

            // Load message history from local storage
            messageHistory.forEach(message => addMessage(message.role, message.content));
        });

        sendButton.addEventListener("click", sendMessage);
        messageInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (message !== "") {
                addMessage("user", message);
                messageInput.value = "";
                messageHistory.push({ role: "user", content: message });
                localStorage.setItem('messageHistory', JSON.stringify(messageHistory));

                const response = await getGroqChatCompletion(messageHistory);
                const aiMessage = response.choices[0]?.message?.content || "";
                addMessage("assistant", aiMessage);
                messageHistory.push({ role: "assistant", content: aiMessage });
                localStorage.setItem('messageHistory', JSON.stringify(messageHistory));
            }
        }

        async function getGroqChatCompletion(messages) {
            return groq.chat.completions.create({
                messages: messages,
                model: selectedModel,
            });
        }

        const optionsList = document.querySelectorAll('.custom-option');
        optionsList.forEach(option => {
            option.addEventListener('click', () => {
                selectedModel = option.getAttribute('data-value');
            });
        });
    </script>

</body>
</html>
